module.exports=function(){const e=require("./paths.js"),{ipcRenderer:t}=require("electron"),{domContentLoadedThen:o,createArrayOf:i,getHostname:n}=require("./util.js"),{onLogin:s,isLoggedIn:r,onAutoLogin:a}=require("./login.js"),{getScoreMethods:d,isDone:c,getTheGapOf:l,findScoreMethodsByNames:g}=require("./score.js"),{lock:u,unlock:h,islocked:f}=require("./lock.js"),{TaskList:k,taskTypes:p}=require("./tasks.js"),m=require("./update.js"),q=["oapi.dingtalk.com","login.dingtalk.com","h5.dingtalk.com"],j="https://login.dingtalk.com/login/index.htm?goto="+encodeURIComponent(e.passwdLoginPage);o(async()=>{const o=t.sendSync("getAutoLoginSettings");if(location.href.startsWith(e.loginPage))return s(),void m();if(location.href.startsWith(j)&&o)return void a(o);if(q.includes(n()))return;if(!r())return void(location.href=o?j:"https://pc.xuexi.cn/points/login.html?ref=https://www.xuexi.cn/");if(t.send("save-cookies"),!f()){const t=await d(),[o,n,s,r]=g(t,["阅读文章","观看视频","文章时长","视频时长"]);if(k.tasks=[],c(o)&&c(s)||k.add(p[0]),k.add(...i(p[1],l(o)),...i(p[2],l(s))),c(n)&&c(r)||k.add(p[3]),k.add(...i(p[4],l(n)),...i(p[5],l(r))),0==k.tasks.length)return;if(u(),location.href.startsWith(e.myStudyPage))return void(location.href=e.homePage)}const y=k.getAll();k.doAll(y),0==y.length&&h()})}();