module.exports=function(){const e=require("./paths.js"),{ipcRenderer:t}=require("electron"),{domContentLoadedThen:o,createArrayOf:i,getHostname:n}=require("./util.js"),{onLogin:s,isLoggedIn:r,onAutoLogin:a}=require("./login.js"),{getScoreMethods:d,isDone:c,getTheGapOf:l,findScoreMethodsByNames:g,showScore:u}=require("./score.js"),{lock:h,unlock:f,islocked:k}=require("./lock.js"),{TaskList:p,taskTypes:m}=require("./tasks.js"),q=require("./update.js"),j=["oapi.dingtalk.com","login.dingtalk.com","h5.dingtalk.com"],y="https://login.dingtalk.com/login/index.htm?goto="+encodeURIComponent(e.passwdLoginPage);o(async()=>{const o=t.sendSync("getAutoLoginSettings");if(location.href.startsWith(e.loginPage))return s(),void q();if(location.href.startsWith(y)&&o)return void a(o);if(j.includes(n()))return;if(!r())return void(location.href=o?y:"https://pc.xuexi.cn/points/login.html?ref=https://www.xuexi.cn/");if(t.send("save-cookies"),!k()){const t=await d(),[o,n,s,r]=g(t,["阅读文章","观看视频","文章时长","视频时长"]);if(p.tasks=[],c(o)&&c(s)||p.add(m[0]),p.add(...i(m[1],l(o)),...i(m[2],l(s))),c(n)&&c(r)||p.add(m[3]),p.add(...i(m[4],l(n)),...i(m[5],l(r))),0==p.tasks.length)return;if(h(),location.href.startsWith(e.myStudyPage))return void(location.href=e.homePage)}u();const L=p.getAll();p.doAll(L),0==L.length&&f()})}();