!function(){const e=require("path"),{app:n,BrowserWindow:o,ipcMain:t}=require("electron"),{getRandomNumberBetween:s}=require("./preload/util.js");let l=null,a=!1;const r=process.argv.includes("headless")||process.argv.includes("--headless"),i=process.argv.includes("dev")||process.argv.includes("--dev");n.commandLine.appendSwitch("autoplay-policy","no-user-gesture-required"),n.on("window-all-closed",function(){n.quit()}),n.on("ready",function(){(l=new o({title:"Fuck 学习强国",width:1e3,height:600,show:!1,icon:e.join(__dirname,"logo.png"),webPreferences:{nodeIntegration:!1,webSecurity:!r,preload:e.join(__dirname,"preload/preload.js")}})).setMenu(null),i&&l.webContents.openDevTools();const n=l.webContents.getUserAgent().replace(/\w+-xuexiqiangguo.+? /,"").replace(/Electron.+? /,"");l.webContents.setUserAgent(n),l.loadURL("https://www.xuexi.cn/"),l.once("ready-to-show",()=>{l.show()}),l.on("closed",()=>{l=null}),l.webContents.on("new-window",(e,n)=>{e.preventDefault(),l.webContents.loadURL(n)}),l.webContents.setAudioMuted(!0),setInterval(async()=>{await new Promise(e=>{setTimeout(()=>{e()},1e3*s(0,2e3))}),a||l.webContents.reload()},864e5)}),t.on("lock",()=>{a=!0}),t.on("unlock",()=>{a=!1}),t.on("islocked",e=>{e.returnValue=a});let c=[];t.on("tasks-getAll",e=>{e.returnValue=c}),t.on("tasks-set",(e,n)=>{c=n}),t.on("tasks-add",(e,...n)=>{i&&console.log(n),c.push(...n)}),t.on("isHeadless",e=>{e.returnValue=r}),t.on("log",(e,...n)=>{console.log(...n)}),t.on("save-cookies",async()=>{const e=l.webContents.session.cookies,n=l.webContents.getURL(),o=()=>new Promise((n,o)=>{e.get({domain:"xuexi.cn"},(e,t)=>{e?o(e):n(t.filter(e=>"__UID__"==e.name||"token"==e.name))})}),t=await o();i&&console.log(t),t.forEach(o=>{e.set({url:n,...o,expirationDate:+new Date/1e3+31536e4},e=>{if(e)throw e})}),i&&console.log(await o())})}();